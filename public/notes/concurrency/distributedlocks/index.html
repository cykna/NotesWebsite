<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="When we talk about Distributed Locks, we are mainly talking about distributed systems, before commenting on distributed Locks, we will talk about distributed systems.
A distributed system is a collection of independent  computers (nodes) that work together and appear to the user as a single coherent system. Key characteristics:

Network Communication: nodes exchanges messages (they don&rsquo;t share memory directly)
Concurrency: multiple machines can execute tasks simultaneously
Partial failures: one machine can fail while others keep running (different from centralized systems).
Consistency and coordination: since data may be spread across nodes, the system must handle synchronization, consensus, and fault tolerante(e.g., Paxos or Raft algorithms)
Examples: distributes databases(Cassandra, MongoDb Cluster), distributed file systems (HDFS), coordination services (Zookeeper, Etcd), and cloud plataforms (AWS, Google Cloud)

In short:">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/notes/concurrency/distributedlocks/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="My New Hugo Site">
  <meta property="og:description" content="When we talk about Distributed Locks, we are mainly talking about distributed systems, before commenting on distributed Locks, we will talk about distributed systems.
A distributed system is a collection of independent computers (nodes) that work together and appear to the user as a single coherent system. Key characteristics:
Network Communication: nodes exchanges messages (they don’t share memory directly) Concurrency: multiple machines can execute tasks simultaneously Partial failures: one machine can fail while others keep running (different from centralized systems). Consistency and coordination: since data may be spread across nodes, the system must handle synchronization, consensus, and fault tolerante(e.g., Paxos or Raft algorithms) Examples: distributes databases(Cassandra, MongoDb Cluster), distributed file systems (HDFS), coordination services (Zookeeper, Etcd), and cloud plataforms (AWS, Google Cloud) In short:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="notes">
<title>Distributed Locks | My New Hugo Site</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/notes/concurrency/distributedlocks/">
<link rel="stylesheet" href="/book.min.1a2cf7ebc00040820952c4e2341e71d7d5b60d173ee3438ff388e77e880de9df.css" integrity="sha256-Giz368AAQIIJUsTiNB5x19W2DRc&#43;40OP84jnfogN6d8=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.67e33560f484200bd7322deb340ca99efcd4b1b1930fd430a7c5b86139554f3d.js" integrity="sha256-Z&#43;M1YPSEIAvXMi3rNAypnvzUsbGTD9Qwp8W4YTlVTz0=" crossorigin="anonymous"></script>

  
</head>
<body dir="ltr" class="book-kind-page book-type-notes book-layout-">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>My New Hugo Site</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>
























</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Distributed Locks</h3>

  <label for="toc-control">
    
    <img src="/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><p>When we talk about Distributed Locks, we are mainly talking about distributed systems, before commenting on distributed Locks, we will talk about distributed systems.</p>
<p>A distributed system is a collection of <strong>independent  computers</strong> (nodes) that work together and appear to the user as a single coherent system. Key characteristics:</p>
<ul>
<li>Network Communication: nodes exchanges messages (they don&rsquo;t share memory directly)</li>
<li>Concurrency: multiple machines can execute tasks simultaneously</li>
<li>Partial failures: one machine can fail while others keep running (different from centralized systems).</li>
<li>Consistency and coordination: since data may be spread across nodes, the system must handle synchronization, consensus, and fault tolerante(e.g., Paxos or Raft algorithms)</li>
<li>Examples: distributes databases(Cassandra, MongoDb Cluster), distributed file systems (HDFS), coordination services (Zookeeper, Etcd), and cloud plataforms (AWS, Google Cloud)</li>
</ul>
<p>In short:</p>

<blockquote class='book-hint '>
  <p>That’s a distributed system: <strong>many people (computers) working together as if they were one.</strong></p>
</blockquote><p>Now, back to Distributed Locks. Distributed locks are sophisticated techniques used to synchronize access to shared resources in distributed environments, ensuring that only one process or node can perform a critical operation at a time, preventing conflicts, inconsistencies, and possible data corruption.</p>
<p>In distributed systems, multiple processes/nodes may attempt to access the same critical resource at the same time (e.g., updating a bank account balance, processing the same queue message, writing a file, start a schedule, job). Local locks (mutexes, semaphores) are insufficient because they only control concurrency within a single process or machine. For this we need a locking mechanism that works across multiple machines connected over the network.</p>
<p><strong>A distributed lock must provide:</strong></p>
<ol>
<li>Mutual Exclusion
Only one client at a time can hold the lock.</li>
<li>Deadlock prevention
If the client holding the lock crashes, the lock should eventually expire(lease or TTL)</li>
<li>Availability
Even under failures, the system should continue granting locks.</li>
<li>Consistency
No two clients should ever believe they both hold the same lock.</li>
<li>Fairness(<strong>optional</strong>)
Locks can be granted in the order of requests (queue-based fairness).</li>
</ol>
<p><strong>Commons implementations</strong></p>
<h6 id="redis-eg-redlock-algorithm"><em>Redis</em> (e.g., Redlock Algorithm)
  <a class="anchor" href="#redis-eg-redlock-algorithm">#</a></h6>
<ul>
<li>Each client sets a key with a TTL.</li>
<li>If the client can successfully set the key in a majority of Redis nodes, it assumes the lock.</li>
<li>TTL ensures auto-release if the client crashes.</li>
</ul>
<p><strong>ASCII flow</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Client A tries to lock <span style="color:#e6db74">&#34;resource-1&#34;</span>
</span></span><span style="display:flex;"><span> ├──&gt; Redis Node 1: OK
</span></span><span style="display:flex;"><span> ├──&gt; Redis Node 2: OK
</span></span><span style="display:flex;"><span> └──&gt; Redis Node 3: FAIL <span style="color:#f92672">(</span>timeout<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Majority acquired <span style="color:#f92672">(</span>2/3<span style="color:#f92672">)</span> → Client A holds the lock</span></span></code></pre></div><h6 id="zookeeper"><em>Zookeeper</em>
  <a class="anchor" href="#zookeeper">#</a></h6>
<ul>
<li>Uses ephemeral znodes: each client creates a temporary node.</li>
<li>The client with the smallest sequence number holds the lock.</li>
<li>If the client disconnects, its znode disappears automatically.</li>
</ul>
<p><strong>ASCII flow</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/locks/resource-1/
</span></span><span style="display:flex;"><span>  ├── lock-0001 <span style="color:#f92672">(</span>Client A<span style="color:#f92672">)</span>  &lt;-- LOCK OWNER
</span></span><span style="display:flex;"><span>  ├── lock-0002 <span style="color:#f92672">(</span>Client B<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  └── lock-0003 <span style="color:#f92672">(</span>Client C<span style="color:#f92672">)</span></span></span></code></pre></div>
<blockquote class='book-hint '>
  <p>If the <strong>Client A</strong> crashes, Zookeeper deletes lock-0001, and <strong>Client B</strong> becomes the new owner</p>
</blockquote><h6 id="etcd"><em>Etcd</em>
  <a class="anchor" href="#etcd">#</a></h6>
<ul>
<li>Uses leases (time-limited key ownership).</li>
<li>Clients acquire a key with PUT key &ndash;lease=10s.</li>
<li>When the leases expires (or client crases), the key is removed</li>
<li>Watchers notify other clients that the lock is free.</li>
</ul>
<h5 id="general-architecture"><em>General Architecture</em>
  <a class="anchor" href="#general-architecture">#</a></h5>
<p>![[architecture-distributed-locks-system.png]]</p>

<blockquote class='book-hint '>
  <ul>
<li>All clients attempt to acquire a lock on resource X.</li>
<li>Only one  succeeds at a time.</li>
<li>The lock expires unless it is renewed (lease).</li>
</ul>
</blockquote><p><strong>Summary</strong></p>
<p>Distributed locks are a coordination mechanism in distributed systems, typically implemented with a middleware like Redis, Zookeeper, Etcd, or Consul. They guarantee <strong>mutual exclusion</strong>, <strong>fault tolerance, and consistency</strong> when multiple processes compete for shared resources.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>









  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
  
  <div class="book-comments">

</div>
  
 
        
        

 
      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    

<aside class="book-toc">
  <div class="book-toc-content">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>



  </div>
</aside>

 
  </main>

  
</body>
</html>


















